---
lab:
    title: '01 - 管理 Azure Active Directory 标识'
    module: '模块 01 - 标识'
---

# 实验室 01 - 管理 Azure Active Directory 标识

# 学生实验室手册

## 实验室场景

为了能使 Contoso 用户使用 Azure AD 进行身份验证，你接到了预配用户和组帐户的任务。组的成员身份应根据用户职务自动更新。你还需要使用一个测试用户帐户来创建一个测试 Azure AD 租户，并授予该帐户 Contoso Azure 订阅资源的有限权限。

## 目标

在本实验室中，你将：

+ 任务 1：创建和配置 Azure AD 用户
+ 任务 2：创建具有已分配成员身份和动态成员身份的 Azure AD 组
+ 任务 3：创建一个 Azure Active Directory (AD) 租户
+ 任务 4：管理 Azure AD 来宾用户 

## 说明

### 练习 1：

#### 任务 1：创建和配置 Azure AD 用户

在此任务中，你将创建和配置 Azure AD 用户。

1. 在 Azure 门户中，搜索并选择 **“Azure Active Directory”**。

1. 在“Azure Active Directory”边栏选项卡上，向下滚动到 **“管理”** 部分，单击 **“用户设置”**，然后查看可用的配置选项。

1. 在“Azure Active Directory”边栏选项卡上找到 **“管理”** 部分，单击 **“用户”**，然后单击你的用户帐户以显示其 **“个人资料”** 设置。 

1. 单击 **“编辑”**，在 **“设置”** 部分把 **“使用位置”** 设置为 **“美国”**，并保存更改。

    >**说明**：为了之后在本实验中将 Azure AD Premium P2 许可证分配给你的用户帐户，这是必要的。

1. 导航回到 **“用户 - 所有用户”** 边栏选项卡，然后单击 **“+ 新建用户”**。

1. 使用以下设置创建一个新用户（保留其他设置为默认值）：

    | 设置 | 数值 |
    | --- | --- |
    | 用户名 | **az104-01a-aaduser1** |
    | 名称 | **az104-01a-aaduser1** |
    | 我来创建密码 | 已启用 |
    | 初始密码 | **Pa55w.rd124** |
    | 使用位置 | **美国** |
    | 职务 | **云管理员** |
    | 部门 | **IT** |

    >**说明**：将完整的 **用户名** **复制到剪贴板**。稍后你将在此任务中使用它。

1. 在用户列表中，单击新创建的用户帐户以显示其边栏选项卡。

1. 查看 **“管理”** 部分中可用的选项，注意，你可以识别出分配到用户帐户的 Azure AD 角色以及该用户帐户对 Azure 资源的权限。

1. 在**“管理”** 部分，单击 **“分配的角色”**，然后单击 **“+ 添加分配”** 按钮并将 **“用户管理员”** 角色分配给 **“az104-01a-aaduser1”**。

    >**说明**：当预配新用户时，你还可以选择分配 Azure AD 角色。

1. 打开一个 **“InPrivate”** 浏览器窗口，并使用新创建的用户帐户登录到 [Azure 门户](https://portal.azure.com)。当提示你更新密码时，请为用户更改密码。

    >**说明**：你无需键入用户名，而是可以直接粘贴剪贴板的内容。

1. 在 Azure 门户中的 **“InPrivate”** 浏览器窗口的 ，搜索并选择 **“Azure Active Directory”**。

    >**说明**：尽管此用户帐户可以访问 Azure Active Directory 租户，但该帐户没有访问 Azure 资源的权限。这是预料之中的，因为这样的访问将需要通过使用基于 Azure 角色的访问控制来明确授权。 

1. 在 **“InPrivate”** 浏览器窗口的“Azure AD”边栏选项卡上，向下滚动到 **“管理”** 部分，单击 **“用户设置”**。请注意，你没有修改任何配置选项的权限。

1. 在 **“InPrivate”** 浏览器窗口的“Azure AD”边栏选项卡上，在 **“管理”** 部分中单击 **“用户”**，然后单击 **“+ 新建用户”**。

1. 使用以下设置创建一个新用户（保留其他设置为默认值）：

    | 设置 | 数值 |
    | --- | --- |
    | 用户名 | **az104-01a-aaduser2** |
    | 名称 | **az104-01a-aaduser2** |
    | 我来创建密码 | 已启用 |
    | 初始密码 | **Pa55w.rd124** |
    | 使用位置 | **美国** |
    | 职务 | **系统管理员** |
    | 部门 | **IT** |

1. 在 Azure 门户注销 az104-01a-aaduser1 用户，然后关闭“InPrivate”浏览器窗口。

#### 任务 2：创建具有已分配成员身份和动态成员资格的 Azure AD 组

在此任务中，你将创建具有已分配成员身份和动态成员身份的 Azure Active Directory 组。

1. 返回已登录用户帐户的 Azure 门户，导航回到 Azure AD 租户的 **“概述”** 边栏选项卡，并且在 **“管理”** 部分，单击 **“许可证”**。

    >**说明**：需要 Azure AD Premium P1 或 P2 许可证才能实现动态组。

1. 在 **“管理”** 部分中，单击 **“所有产品”**。

1. 单击 **“+ 尝试/购买”**并激活 Azure AD Premium P2 的免费试用版。

1. 刷新浏览器窗口，以验证激活是否成功。 

1. 从 **“许可证 - 所有产品”** 边栏选项卡中，选择 **“Azure Active Directory Premium P2”** 条目，然后将“Azure AD Premium P2”中的所有许可证选项分配给你的用户帐户和两个新创建的用户帐户。

1. 在 Azure 门户中，导航回到“Azure AD 租户”边栏选项卡，并单击 **“组”**。

1. 使用 **“+ 新建组”** 按钮来创建一个新组，设置如下：

    | 设置 | 数值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名 | **IT 云管理员** |
    | 组描述 | **Contoso IT 云管理员** |
    | 成员身份类型 | **动态用户** |

    >**说明**：如果 **“成员身份类型”** 下拉列表显示为灰色，请刷新浏览器页面。

1. 单击**添加动态查询**。

1. 在 **“动态成员身份规则”** 边栏选项卡中的 **“配置规则”** 选项卡上创建新规则，设置如下：

    | 设置 | 数值 |
    | --- | --- |
    | 属性 | **jobTitle** |
    | 运算符 | **等于** |
    | 数值 | **云管理员** |

1. 保存规则，然后返回 **“新建组”** 边栏选项卡，单击 **“创建”**。 

1. 返回 Azure AD 租户的 **“组 - 所有组”** 边栏选项卡，单击 **“+ 新建组”** 按钮创建一个新组，设置如下：

    | 设置 | 数值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名 | **IT 系统管理员** |
    | 组描述 | **Contoso IT 系统管理员** |
    | 成员身份类型 | **动态用户** |

1. 单击 **添加动态查询**。

1. 在 **“动态成员身份规则”** 边栏选项卡中的 **“配置规则”** 选项卡上创建新规则，设置如下：

    | 设置 | 数值 |
    | --- | --- |
    | 属性 | **jobTitle** |
    | 运算符 | **等于** |
    | 数值 | **系统管理员** |

1. 保存规则，然后返回 **“新建组”** 边栏选项卡，单击 **“创建”**。 

1. 返回 Azure AD 租户的 **“组 - 所有组”** 边栏选项卡，单击 **“+ 新建组”** 按钮创建一个新组，设置如下：

    | 设置 | 数值 |
    | --- | --- |
    | 组类型 | **安全性** |
    | 组名 | **IT 实验室管理员** |
    | 组描述 | **Contoso IT 实验室管理员** |
    | 成员身份类型 | **已分配** |

1. 单击 **“未选择成员”**。

1. 从 **“添加成员”** 边栏选项卡中搜索和选择 **“IT 云管理员”** 和 **“IT 系统管理员”** 组，然后回到 **“新建组”** 边栏选项卡，单击 **“创建”**。

1. 返回 **“组 - 所有组”** 边栏选项卡，单击表示 **“IT 云管理员”** 组的条目，然后显示其 **“成员”** 边栏选项卡。验证 **az104-01a-aaduser1** 是否出现在组成员列表中。

1. 导航回 **“组 - 所有组”** 边栏选项卡，单击代表 **“IT 系统管理员”** 组的条目，然后显示其 **“成员”** 边栏选项卡。验证 **az104-01a-aaduser2** 是否出现在组成员列表中。

    >**说明**：动态成员身份组的更新可能会导致延迟。如要加快更新速度，请导航至“组”边栏选项卡，显示其 **“动态成员身份规则”** 边栏选项卡， 通过在末尾添加一个空格来 **编辑** **“规则语法”** 文本框中列出的规则，然后 **保存** 更改。

#### 任务 3：创建 Azure Active Directory (AD) 租户

在此任务中，将创建一个新的 Azure AD 租户。

1. 在 Azure 门户中，搜索并选择 **“Azure Active Directory”**。

1. 单击 **“+ 创建目录”**，并指定以下设置：

    | 设置 | 数值 |
    | --- | --- |
    | 目录类型 | **Azure Active Directory** |
    | 组织名称 | **Contoso 实验室** |
    | 初始域名 | 任何有效的 DNS 名称，包括小写字母和数字，并以字母开头 | 
    | 国家/地区 | **美国** |

   > **说明**： **“初始域名”** 文本框中的绿色复选标记将指示你输入的域名是否有效且唯一。

1. 单击 **“查看 + 创建”**，然后单击 **“创建”**。

1. 通过 **单击此处导航到你的新目录** 显示新建的 “Azure AD 租户” **边栏选项卡： “Contoso 实验室”** 链接或 Azure 门户工具栏中的 **“目录 + 订阅”** 按钮（Cloud Shell 按钮的右侧）。

#### 任务 4：管理 Azure AD 来宾用户。

在此任务中，你将创建 Azure AD 来宾用户，并授予它们访问 Azure 订阅资源的权限。

1. 在显示了 Contoso 实验室 Azure AD 租户的 Azure 门户中 ，在 **“管理”** 部分单击 **“用户”**，然后单击 **“+ 新建用户”**。

1. 使用以下设置创建一个新用户（保留其他设置为默认值）：

    | 设置 | 数值 |
    | --- | --- |
    | 用户名 | **az104-01b-aaduser1** |
    | 名称 | **az104-01b-aaduser1** |
    | 我来创建密码 | 已启用 |
    | 初始密码 | **Pa55w.rd124** |
    | 职务 | **系统管理员** |
    | 部门 | **IT** |

    >**说明**：将完整的 **用户名 复制到剪贴板**。稍后你将在此任务中使用它。

1. 通过 Azure 门户的工具栏中的 **“目录 + 订阅”** 按钮（就在 Cloud Shell 按钮的右侧）切换回你的默认 Azure AD 租户。

1. 返回 **“用户 - 所有用户”** 边栏选项卡，然后单击 **“+ 新建来宾用户”**。

1. 创建一个新的来宾用户，设置如下（保留其他设置的默认值）：

    | 设置 | 数值 |
    | --- | --- |
    | 名称 | **az104-01b-aaduser1** |
    | 电子邮件地址 | 粘贴之前在任务中复制到剪贴板中的值 |
    | 使用位置 | **美国** |
    | 职务 | **实验室管理员** |
    | 部门 | **IT** |

1. 单击 **“邀请”**。 

1. 返回 **“用户 - 所有用户”** 边栏选项卡，单击代表新创建的来宾用户帐户的条目。

1. 在 **“az104-01b-aaduser1 - 个人资料”** 边栏选项卡中，单击 **“组”**。

1. 单击 **“+ 添加成员身份”**，并将来宾用户帐户添加到 **“IT 实验室管理员”**组。


#### 清理资源

   >**说明**：记得移除任何你不再使用的新创建的 Azure 资源。移除未使用的资源，确保不会产生意外成本。在这种情况下，虽然没有与 Azure Active Directory 租户及其对象相关的额外费用，但你可能要考虑移除在此实验室中创建的用户帐户、组帐户以及 Azure Active Directory 租户。

1. 在 Azure 门户中，导航到 **“用户 - 所有用户”** 边栏选项卡，单击代表 **“az104-01b-aaduser1”** 来宾用户帐户的条目，在 **“az104-01b-aaduser1 - 个人资料”** 边栏选项卡上单击 **“删除”**，然后，在提示确认时，单击 **“确定”**。

1. 重复相同顺序的步骤，以删除你在此实验室中创建的其余用户帐户。

1. 导航到 **“组 - 所有组”** 边栏选项卡，选择你在此实验室中创建的组，单击 **“删除”**，然后在提示确认时，单击 **“确认”**。

1. 导航到 **“Azure Active Directory Premium P2 - 许可用户”** 边栏选项卡，选择你在此实验室中分配了许可证的用户帐户，单击 **“删除许可证”**，然后在提示确认时，单击 **“确认”**。

1. 在 Azure 门户中，使用“Azure 门户”工具栏中的 **“目录 + 订阅”** 按钮（在 Cloud Shell 按钮右侧）显示“Contoso 实验室 Azure AD 租户”边栏选项卡。

1. 导航到 **“用户 - 所有用户”** 边栏选项卡，单击代表 **az104-01b-aaduser1** 用户帐户的条目，在 **“az104-01b-aaduser1 - 个人资料”** 边栏选项卡处单击 **“删除”**，然后在提示确认时，单击 **“确认”**。

1. 导航到 Contoso Lab Azure AD 租户的 **“Contoso 实验室 - 概述”** 边栏选项卡，单击 **“删除目录”**，在 **“删除目录‘Contoso 实验室’”** 边栏选项卡中，单击 **“获得删除 Azure 资源的权限”** 的链接，在 **“Azure Active Directory”的“属性”** 边栏选项卡上，设置 **“Azure 资源的访问管理”** 为 **“是”** ，然后点击 **“保存”**。

1. 从 Azure 门户注销并重新登录。 

1. 导航回 **“删除目录‘Contoso 实验室’”** 边栏选项卡，并单击 **“删除”**。

#### 回顾

在本实验室中，你已：

- 创建和配置 Azure AD 用户
- 创建具有已分配成员身份和动态成员身份的 Azure AD 组
- 创建 Azure Active Directory (AD) 租户
- 管理 Azure AD 来宾用户 